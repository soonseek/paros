---
stepsCompleted: ["step-01-validate-prerequisites", "step-02-design-epics", "step-03-create-stories"]
inputDocuments:
  - "_bmad-output/planning-artifacts/prd.md"
  - "_bmad-output/planning-artifacts/architecture.md"
  - "_bmad-output/planning-artifacts/ux-design-specification.md"
---

# pharos-bmad - Epic Breakdown

## Overview

This document provides the complete epic and story breakdown for pharos-bmad, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.

## Requirements Inventory

### Functional Requirements

From PRD.md - 50 Functional Requirements across 10 capability areas:

#### FR1-FR5: 계정 관리 및 인증 (Account Management & Authentication)
- **FR-001**: 사용자는 이메일과 비밀번호로 회원가입할 수 있어야 한다
- **FR-002**: 사용자는 이메일 인증을 통해 계정을 활성화해야 한다
- **FR-003**: 사용자는 JWT 기반 로그인/로그아웃을 수행할 수 있어야 한다
- **FR-004**: 사용자는 비밀번호 찾기 및 재설정을 할 수 있어야 한다
- **FR-005**: 사용자는 자신의 프로필 정보를 조회하고 수정할 수 있어야 한다

#### FR6-FR12: 사건 관리 (Case Management)
- **FR-006**: 변호사는 새로운 파산 사건을 등록할 수 있어야 한다
- **FR-007**: 변호사는 사건의 기본 정보(사건번호, 채무자명, 법원 등)를 입력할 수 있어야 한다
- **FR-008**: 변호사는 사건 목록을 조회하고 검색할 수 있어야 한다
- **FR-009**: 변호사는 특정 사건의 상세 정보를 조회할 수 있어야 한다
- **FR-010**: 변호사는 사건 정보를 수정할 수 있어야 한다
- **FR-011**: 변호사는 사건을 아카이브 처리할 수 있어야 한다
- **FR-012**: 변호사는 사건에 메모를 추가할 수 있어야 한다

#### FR13-FR21: 거래내역서 업로드 및 전처리 (Bank Statement Upload & Preprocessing)
- **FR-013**: 사용자는 다양한 포맷의 거래내역서(엑셀, CSV, PDF)를 업로드할 수 있어야 한다
- **FR-014**: 시스템은 업로드된 파일의 형식을 자동으로 감지하고 검증해야 한다
- **FR-015**: 시스템은 업로드된 파일의 구조를 분석하여 열(날짜, 입금액, 출금액, 잔액, 메모 등)을 식별해야 한다
- **FR-016**: 시스템은 한글 및 영문 헤더를 모두 지원해야 한다
- **FR-017**: 시스템은 업로드된 거래내역을 데이터베이스에 저장해야 한다
- **FR-018**: 시스템은 업로드 실패 시 명확한 에러 메시지를 표시해야 한다
- **FR-019**: 사용자는 업로드된 거래내역을 미리보기 할 수 있어야 한다
- **FR-020**: 사용자는 업로드 전 파일을 삭제할 수 있어야 한다
- **FR-021**: 시스템은 대용량 파일(최대 50MB) 처리를 지원해야 한다

#### FR22-FR31: AI 거래 분류 (Transaction Classification)
- **FR-022**: 시스템은 각 거래를 분류하여 태그를 부여해야 한다 (입금, 출금, 이체, 수수료, 기타 등)
- **FR-023**: 시스템은 거래 메모를 기반으로 입출금 내역을 자동 분류해야 한다
- **FR-024**: AI는 불확실한 분류에 대해 신뢰도 점수(confidence score)를 제공해야 한다
- **FR-025**: 시스템은 중요 거래(대출 실행, 변제, 담보제공 등)를 자동 식별해야 한다
- **FR-026**: 시스템은 거래의 성격(채권자 관련, 담보 관련, 우선변제 관련)을 판단해야 한다
- **FR-027**: 사용자는 AI 분류 결과를 수동으로 수정할 수 있어야 한다
- **FR-028**: 사용자는 태그를 추가하거나 삭제할 수 있어야 한다
- **FR-029**: 시스템은 사용자의 수정을 학습하여 향후 분류 정확도를 높여야 한다
- **FR-030**: 시스템은 분류되지 않은 거래를 식별하고 알려야 한다
- **FR-031**: 시스템은 일괄 분류 및 수정을 지원해야 한다

#### FR32-FR37: 자금 흐름 추적 (Flow Tracing)
- **FR-032**: 사용자는 특정 거래의 자금 출처를 추적할 수 있어야 한다
- **FR-033**: 사용자는 특정 거래의 자금 사용처를 추적할 수 있어야 한다
- **FR-034**: 시스템은 관련 거래 간의 연결고리를 시각화해야 한다
- **FR-035**: 시스템은 거래 체인(예: 대출 실행 → 자금 이체 → 담보제공)을 식별해야 한다
- **FR-036**: 사용자는 추적 범위를 필터링할 수 있어야 한다 (날짜, 금액, 태그 등)
- **FR-037**: 시스템은 추적 결과를 내보낼 수 있어야 한다

#### FR38-FR44: 발견 사항 관리 (Findings Management)
- **FR-038**: 시스템은 파산 사건과 관련된 중요 발견사항을 자동 식별해야 한다
- **FR-039**: 시스템은 선의성/악의성 판단 관련 거래를 감지해야 한다
- **FR-040**: 시스템은 우선변제권 침해 가능성이 있는 거래를 표시해야 한다
- **FR-041**: 시스템은 담보권 설정/변경/소멸 관련 거래를 감지해야 한다
- **FR-042**: 사용자는 발견사항에 메모를 추가할 수 있어야 한다
- **FR-043**: 사용자는 발견사항을 채권자별로 필터링할 수 있어야 한다
- **FR-044**: 사용자는 발견사항의 중요도를 지정할 수 있어야 한다

#### FR45-FR48: 보고서 생성 및 내보내기 (Reporting & Export)
- **FR-045**: 사용자는 분석 결과를 엑셀 형식으로 내보낼 수 있어야 한다
- **FR-046**: 사용자는 특정 거래 목록을 선택하여 내보낼 수 있어야 한다
- **FR-047**: 사용자는 발견사항 목록을 내보낼 수 있어야 한다
- **FR-048**: 사용자는 자금 흐름 추적 결과를 내보낼 수 있어야 한다

#### FR49-FR50: 검색 및 필터링 (Search & Filtering)
- **FR-049**: 사용자는 거래내역을 다양한 조건으로 검색할 수 있어야 한다 (날짜, 금액, 키워드, 태그)
- **FR-050**: 사용자는 거래내역을 여러 필터 조합으로 조회할 수 있어야 한다

### NonFunctional Requirements

From PRD.md - 23 NonFunctional Requirements across 5 categories:

#### NFR1-NFR5: 성능 (Performance)
- **NFR-001**: 거래내역서 업로드 처리는 50MB 파일 기준 30초 이내 완료되어야 한다
- **NFR-002**: AI 거래 분류는 1,000건 기준 60초 이내 완료되어야 한다
- **NFR-003**: 자금 흐름 추적 쿼리 응답 시간은 3초 이내여야 한다
- **NFR-004**: 웹페이지 초기 로딩 시간은 2초 이내여야 한다
- **NFR-005**: 대시보드 및 보고서 생성은 5초 이내 완료되어야 한다

#### NFR6-NFR9: 보안 (Security)
- **NFR-006**: 모든 데이터 전송은 HTTPS/TLS 1.3 이상으로 암호화되어야 한다
- **NFR-007**: 사용자 비밀번호는 bcrypt로 해싱되어 저장되어야 한다
- **NFR-008**: 민감한 법률 데이터는 암호화된 상태로 DB에 저장되어야 한다
- **NFR-009**: JWT Access Token 유효기간은 15분, Refresh Token은 8시간이어야 한다

#### NFR10-NFR13: 신뢰성 (Reliability)
- **NFR-010**: 시스템 가용성은 99.5% 이상이어야 한다
- **NFR-011**: 데이터 백업은 매일 자동으로 수행되어야 한다
- **NFR-012**: 장애 발생 시 평균 복구 시간(MTTR)은 4시간 이내여야 한다
- **NFR-013**: AI 분석 실패 시에도 시스템은 계속 운영되어야 한다 (graceful degradation)

#### NFR14-NFR17: 통합 (Integration)
- **NFR-014**: 시스템은 Upstage Solar API, Google Cloud Vision API, OpenAI/Anthropic API와 통합 가능해야 한다
- **NFR-015**: 외부 API 호출 실패 시 재시도 메커니즘이 있어야 한다
- **NFR-016**: 파일 업로드는 S3와 직접 통합하여 처리해야 한다
- **NFR-017**: 외부 API 레이트 리밋을 준수하는 재시도 전략이 필요하다

#### NFR18-NFR23: 확장성 및 유지보수성 (Scalability & Maintainability)
- **NFR-018**: 시스템은 최소 100명의 동시 사용자를 지원해야 한다
- **NFR-019**: 데이터베이스는 최소 100만건의 거래 데이터를 저장할 수 있어야 한다
- **NFR-020**: 코드베이스의 80% 이상이 타입스크립트 타입으로 커버되어야 한다
- **NFR-021**: 모든 API 엔드포인트에 대한 통합 테스트가 있어야 한다
- **NFR-022**: 주요 기능에 대한 E2E 테스트가 있어야 한다
- **NFR-023**: API 변경 시 자동으로 문서가 생성되어야 한다

### Additional Requirements

#### Technical Requirements (from Architecture.md)

**스타터 템플릿 및 프레임워크:**
- T3 Stack (create-t3-app) 기반 프로젝트 구조
- Next.js 14+ (App Router), TypeScript, Tailwind CSS
- tRPC v11, Prisma ORM 7.2.0, Zod v4

**데이터베이스 아키텍처:**
- Neon Database (PostgreSQL) - AWS Seoul 리전
- Prisma 모듈형 스키마 (7개 도메인 파일)
- Prisma Accelerator 적용
- Direct Database Access 접근 패턴

**인증 및 권한:**
- JWT 기반 인증 (Access Token 15분 + Refresh Token 8시간)
- HttpOnly Cookie 기반 토큰 저장
- RBAC (4가지 역할: LAWYER, PARALEGAL, ADMIN, SUPPORT)
- tRPC context 기반 권한 체크

**API 아키텍처:**
- tRPC v11 (7개 도메인 라우터)
- Zod v4 기반 입력 검증
- React Query v5 (서버 상태 관리)
- 서버 액션(SPA 상태 변이)

**실시간 기능:**
- SSE (Server-Sent Events) 기반 진행률 업데이트
- useRealtimeProgress 커스텀 훅

**프론트엔드:**
- Atomic Design (5계층 컴포넌트 구조)
- shadcn/ui (Radix UI 기반)
- TanStack Table v8 (React Table v8)
- React Hook Form + Zod
- Zustand (클라이언트 상태)

**배포 및 인프라:**
- Vercel 배포
- AWS S3 (ap-northeast-2) 파일 저장
- Upstash Redis (레이트 리밋)

**개발 도구:**
- ESLint, Prettier
- Husky (pre-commit 훅)
- TypeScript Strict Mode

#### UX Design Requirements (from ux-design-specification.md)

**디자인 시스템:**
- Tailwind CSS + shadcn/ui 조합
- TanStack Table v8 (Excel 스타일 인터랙션)
- 색상 체계: Primary(blue-600), Success(green-600), Warning(amber-600), Error(red-600), Info(orange-600)
- 폰트: Pretendard (한국어 최적화)

**레이아웃:**
- Split View 구조 (왼쪽 40%: 발견사항 + 필터, 오른쪽 60%: 테이블)
- 반응형: Desktop(1920px, 1366px), iPad(1024px, 768px)

**컴포넌트:**
- UploadZone (파일 드래그앤드롭)
- ProgressBar (SSE 실시간 진행률)
- FindingCard (발견사항 카드)
- TransactionTable (가상화된 테이블)
- TagCell (태그 셀)
- FilterPanel (필터 패널)

**접근성:**
- WCAG 2.1 AA 준수
- 색상 명도 대비 4.5:1 이상
- 키보드 네비게이션 지원
- 스크린리더 호환

### FR Coverage Map

```
FR-001 ~ FR-005: Epic 1 - 사용자 인증 및 프로필 관리 (계정 관리 및 인증)
FR-006 ~ FR-012: Epic 2 - 파산 사건 관리 (사건 등록, 조회, 수정, 아카이브)
FR-013 ~ FR-021: Epic 3 - 거래내역서 업로드 및 전처리 (파일 업로드, 구조 분석, DB 저장)
FR-022 ~ FR-031: Epic 4 - AI 기반 거래 분류 (자동 분류, 신뢰도 점수, 수동 수정)
FR-032 ~ FR-037: Epic 5 - 자금 흐름 추적 (출처/사용처 추적, 체인 식별, 시각화)
FR-038 ~ FR-044: Epic 6 - 발견 사항 관리 (자동 식별, 메모, 채권자별 필터링)
FR-045 ~ FR-048: Epic 7 - 분석 결과 내보내기 (엑셀 내보내기)
FR-049 ~ FR-050: Epic 8 - 검색 및 필터링 (다차원 검색, 필터 조합)
```

**요약:** 총 8개 Epic, 모든 50개 FR 커버 완료

## Epic List

### Epic 1: 사용자 인증 및 프로필 관리
법률 전문가가 시스템에 안전하게 가입하고 로그인하며 자신의 프로필을 관리할 수 있다.
**FRs covered:** FR-001, FR-002, FR-003, FR-004, FR-005
**의존성:** 없음 (독립적)
**구현 고려사항:** JWT 인증 (Access 15분 + Refresh 8시간), HttpOnly Cookie, RBAC (4가지 역할), bcrypt 비밀번호 해싱

### Epic 2: 파산 사건 관리
변호사가 파산 사건을 등록하고, 목록을 조회하며, 사건 상세 정보를 관리할 수 있다.
**FRs covered:** FR-006, FR-007, FR-008, FR-009, FR-010, FR-011, FR-012
**의존성:** Epic 1 (인증 필요)
**구현 고려사항:** 사건 기본 정보 (사건번호, 채무자명, 법원 등), 사건 검색 및 필터링, 사건 메모, 아카이브 처리

### Epic 3: 거래내역서 업로드 및 전처리
사용자가 엑셀/CSV/PDF 형식의 거래내역서를 업로드하고 시스템이 자동으로 구조를 분석하여 저장한다.
**FRs covered:** FR-013, FR-014, FR-015, FR-016, FR-017, FR-018, FR-019, FR-020, FR-021
**의존성:** Epic 1, Epic 2
**구현 고려사항:** 파일 형식 자동 감지, 한글/영문 헤더 지원, 대용량 파일 (최대 50MB), S3 직접 통합, SSE 진행률, 구조 분석 및 열 식별

### Epic 4: AI 기반 거래 분류
시스템이 AI로 각 거래를 자동 분류하고, 사용자가 수동으로 수정하며 태그를 관리할 수 있다.
**FRs covered:** FR-022, FR-023, FR-024, FR-025, FR-026, FR-027, FR-028, FR-029, FR-030, FR-031
**의존성:** Epic 3
**구현 고려사항:** Upstage Solar/Google Cloud Vision/OpenAI/Anthropic API 통합, 신뢰도 점수, 중요 거래 자동 식별, 수동 수정 및 일괄 수정, 학습 피드백 루프

### Epic 5: 자금 흐름 추적
사용자가 특정 거래의 자금 출처와 사용처를 추적하고 관련 거래 간 연결고리를 시각화한다.
**FRs covered:** FR-032, FR-033, FR-034, FR-035, FR-036, FR-037
**의존성:** Epic 3, Epic 4
**구현 고려사항:** 자금 출처/사용처 추적, 거래 체인 식별, 연결고리 시각화, 다차원 필터링

### Epic 6: 발견 사항 관리
시스템이 파산 사건과 관련된 중요 발견사항을 자동 식별하고 사용자가 메모를 추가하며 채권자별로 필터링할 수 있다.
**FRs covered:** FR-038, FR-039, FR-040, FR-041, FR-042, FR-043, FR-044
**의존성:** Epic 3, Epic 4
**구현 고려사항:** 자동 발견사항 식별 (선의성/악의성, 우선변제권 침해, 담보권 설정/변경/소멸), 발견사항 메모, 채권자별 필터링, 중요도 지정, 색상 코딩 (🔴🟡🟠)

### Epic 7: 분석 결과 내보내기
사용자가 분석 결과, 거래 목록, 발견사항, 자금 흐름 추적 결과를 엑셀 형식으로 내보낼 수 있다.
**FRs covered:** FR-045, FR-046, FR-047, FR-048
**의존성:** Epic 3, Epic 4, Epic 5, Epic 6
**구현 고려사항:** 엑셀 형식 내보내기, 선택적 거래 목록 내보내기, 발견사항 목록 내보내기, 자금 흐름 추적 결과 내보내기

### Epic 8: 검색 및 필터링
사용자가 거래내역을 다양한 조건(날짜, 금액, 키워드, 태그)으로 검색하고 여러 필터 조합으로 조회할 수 있다.
**FRs covered:** FR-049, FR-050
**의존성:** Epic 3
**구현 고려사항:** 다차원 검색 (날짜, 금액, 키워드, 태그), 여러 필터 조합, 고성능 쿼리 (3초 이내 응답)

---

## Epic 1: 사용자 인증 및 프로필 관리

법률 전문가가 시스템에 안전하게 가입하고 로그인하며 자신의 프로필을 관리할 수 있다.

### Story 1.1: 사용자 회원가입

As a 법률 전문가,
I want 이메일과 비밀번호로 회원가입을 하고 이메일 인증을 받아서,
So that 시스템에 안전하게 접근할 수 있다.

**Acceptance Criteria:**

**Given** 회원가입 페이지에 접근했을 때
**When** 사용자가 유효한 이메일과 비밀번호(8자 이상)를 입력하고 가입하기 버튼을 클릭하면
**Then** 이메일 인증 링크가 발송되고 "인증 이메일을 발송했습니다" 메시지가 표시된다
**And** 사용자는 User 테이블에 생성되지만 isActive 상태는 false이다
**And** 이메일 인증 전에는 로그인할 수 없다

**Given** 사용자가 인증 이메일을 받았을 때
**When** 이메일의 인증 링크를 클릭하면
**Then** 사용자의 isActive 상태가 true로 변경되고 로그인 페이지로 리다이렉트된다
**And** "이메일 인증이 완료되었습니다" 메시지가 표시된다

**Given** 사용자가 이미 존재하는 이메일로 가입을 시도할 때
**When** 가입하기 버튼을 클릭하면
**Then** "이미 사용 중인 이메일입니다" 에러 메시지가 표시된다

**Given** 사용자가 유효하지 않은 이메일 형식을 입력할 때
**When** 가입하기 버튼을 클릭하면
**Then** "유효한 이메일 주소를 입력해주세요" 에러 메시지가 표시된다

**Requirements:** FR-001, FR-002, NFR-007 (bcrypt 비밀번호 해싱)

### Story 1.2: 사용자 로그인 및 로그아웃

As a 인증된 사용자,
I want 이메일과 비밀번호로 로그인하고 로그아웃해서,
So that 내 세션을 안전하게 관리할 수 있다.

**Acceptance Criteria:**

**Given** 인증된 사용자가 로그인 페이지에 접근했을 때
**When** 올바른 이메일과 비밀번호를 입력하고 로그인 버튼을 클릭하면
**Then** JWT Access Token(15분 유효)과 Refresh Token(8시간 유효)이 발급된다
**And** Refresh Token은 HttpOnly Cookie에 저장된다
**And** 대시보드 페이지로 리다이렉트된다

**Given** 인증되지 않은 사용자나 비활성화된 계정으로 로그인을 시도할 때
**When** 이메일과 비밀번호를 입력하고 로그인 버튼을 클릭하면
**Then** "이메일 또는 비밀번호가 올바르지 않습니다" 에러 메시지가 표시된다

**Given** 로그인된 사용자가 로그아웃 버튼을 클릭할 때
**When** 로그아웃을 확인하면
**Then** HttpOnly Cookie의 Refresh Token이 삭제되고 로그인 페이지로 리다이렉트된다
**And** 클라이언트의 Access Token도 삭제된다

**Given** Access Token이 만료되었을 때
**When** 사용자가 새로운 요청을 하면
**Then** Refresh Token을 사용하여 자동으로 새 Access Token이 발급된다
**And** 사용자 경험에 중단 없이 계속 사용할 수 있다

**Requirements:** FR-003, NFR-009 (JWT 15분/8시간), NFR-006 (HTTPS/TLS 1.3)

### Story 1.3: 비밀번호 찾기 및 재설정

As a 비밀번호를 잊어버린 사용자,
I want 이메일을 통해 비밀번호를 재설정해서,
So that 계정에 다시 접근할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 로그인 페이지에서 "비밀번호 찾기"를 클릭했을 때
**When** 등록된 이메일 주소를 입력하고 전송 버튼을 클릭하면
**Then** 비밀번호 재설정 링크가 포함된 이메일이 발송된다
**And** "비밀번호 재설정 링크를 이메일로 발송했습니다" 메시지가 표시된다

**Given** 사용자가 비밀번호 재설정 이메일을 받았을 때
**When** 재설정 링크를 클릭하면
**Then** 비밀번호 재설정 페이지로 이동하고 링크는 1시간 동안 유효하다

**Given** 사용자가 비밀번호 재설정 페이지에서 새 비밀번호를 입력할 때
**When** 새 비밀번호(8자 이상)와 확인 비밀번호를 입력하고 제출하면
**Then** 비밀번호가 bcrypt로 해싱되어 DB에 저장된다
**And** "비밀번호가 재설정되었습니다" 메시지가 표시된다
**And** 로그인 페이지로 리다이렉트된다

**Given** 사용자가 존재하지 않는 이메일로 비밀번호 찾기를 요청할 때
**When** 전송 버튼을 클릭하면
**Then** 보안을 위해 동일한 성공 메시지가 표시되지만 이메일은 발송되지 않는다

**Requirements:** FR-004, NFR-007 (bcrypt)

### Story 1.4: 사용자 프로필 관리

As a 로그인된 사용자,
I want 내 프로필 정보를 조회하고 수정해서,
So that 내 계정 정보를 최신으로 유지할 수 있다.

**Acceptance Criteria:**

**Given** 로그인된 사용자가 프로필 페이지에 접근했을 때
**When** 페이지가 로드되면
**Then** 사용자의 현재 정보(이름, 이메일, 역할, 가입일)가 표시된다

**Given** 사용자가 프로필 정보를 수정할 때
**When** 이름 필드를 수정하고 저장 버튼을 클릭하면
**Then** 변경사항이 User 테이블에 저장되고 "프로필이 업데이트되었습니다" 메시지가 표시된다

**Given** 사용자가 이메일을 변경하려고 할 때
**When** 새 이메일 주소를 입력하고 저장 버튼을 클릭하면
**Then** 새 이메일로 인증 링크가 발송되고 isActive 상태가 false로 변경된다
**And** 새 이메일로 인증을 완료해야 로그인할 수 있다

**Given** 사용자가 비밀번호를 변경하려고 할 때
**When** 현재 비밀번호와 새 비밀번호를 입력하고 변경 버튼을 클릭하면
**Then** 현재 비밀번호가 확인되고 새 비밀번호가 bcrypt로 해싱되어 저장된다
**And** "비밀번호가 변경되었습니다" 메시지가 표시된다

**Requirements:** FR-005

---

## Epic 2: 파산 사건 관리

변호사가 파산 사건을 등록하고, 목록을 조회하며, 사건 상세 정보를 관리할 수 있다.

### Story 2.1: 사건 등록

As a 변호사,
I want 새로운 파산 사건의 기본 정보를 입력하고 등록해서,
So that 의뢰인의 파산 사건을 시스템에서 관리할 수 있다.

**Acceptance Criteria:**

**Given** 로그인된 변호사가 "새 사건 등록" 페이지에 접근했을 때
**When** 사건번호, 채무자명, 법원명, 접수일자를 입력하고 저장 버튼을 클릭하면
**Then** Case 테이블에 새 사건이 생성되고 "사건이 등록되었습니다" 메시지가 표시된다
**And** 사건 목록 페이지로 리다이렉트된다
**And** 사건은 현재 로그인된 변호사와 연결된다

**Given** 변호사가 필수 필드(사건번호, 채무자명)를 입력하지 않았을 때
**When** 저장 버튼을 클릭하면
**Then** "필수 항목을 모두 입력해주세요" 에러 메시지가 표시된다

**Given** 변호사가 이미 존재하는 사건번호로 등록을 시도할 때
**When** 저장 버튼을 클릭하면
**Then** "이미 존재하는 사건번호입니다" 에러 메시지가 표시된다

**Requirements:** FR-006, FR-007

### Story 2.2: 사건 목록 조회 및 검색

As a 변호사,
I want 내 모든 사건 목록을 조회하고 검색/필터링해서,
So that 원하는 사건을 빠르게 찾을 수 있다.

**Acceptance Criteria:**

**Given** 로그인된 변호사가 사건 목록 페이지에 접근했을 때
**When** 페이지가 로드되면
**Then** 현재 변호사의 모든 활성 사건이 테이블 형태로 표시된다
**And** 각 행에는 사건번호, 채무자명, 법원, 접수일자, 상태가 표시된다

**Given** 변호사가 검색어를 입력할 때
**When** 사건번호 또는 채무자명으로 검색하면
**Then** 검색어와 일치하는 사건만 필터링되어 표시된다

**Given** 변호사가 법원별 필터를 적용할 때
**When** 특정 법원을 선택하면
**Then** 해당 법원의 사건만 표시된다

**Given** 변호사가 접수일자 범위를 선택할 때
**When** 시작일과 종료일을 설정하면
**Then** 해당 기간 내 접수된 사건만 표시된다

**Given** 다른 변호사의 사건에 접근하려고 할 때
**When** URL을 통해 직접 접근을 시도하면
**Then** "권한이 없습니다" 에러 메시지가 표시된다

**Requirements:** FR-008

### Story 2.3: 사건 상세 조회

As a 변호사,
I want 특정 사건의 상세 정보를 조회해서,
So that 사건의 모든 정보를 확인할 수 있다.

**Acceptance Criteria:**

**Given** 변호사가 사건 목록에서 특정 사건을 클릭했을 때
**When** 사건 상세 페이지로 이동하면
**Then** 사건의 모든 정보(사건번호, 채무자명, 법원, 접수일자, 상태, 메모 등)가 표시된다

**Given** 변호사가 자신의 사건이 아닌 다른 사건에 접근하려고 할 때
**When** URL을 통해 직접 접근을 시도하면
**Then** "권한이 없습니다" 에러 메시지가 표시되고 사건 목록으로 리다이렉트된다

**Given** 존재하지 않는 사건 ID로 접근하려고 할 때
**When** URL을 통해 접근을 시도하면
**Then** "사건을 찾을 수 없습니다" 에러 메시지가 표시되고 사건 목록으로 리다이렉트된다

**Requirements:** FR-009

### Story 2.4: 사건 정보 수정

As a 변호사,
I want 사건 기본 정보를 수정해서,
So that 변경된 정보를 최신으로 유지할 수 있다.

**Acceptance Criteria:**

**Given** 변호사가 자신의 사건 상세 페이지에 있을 때
**When** "수정" 버튼을 클릭하면
**Then** 편집 가능한 필드(채무자명, 법원, 상태 등)가 표시된다

**Given** 변호사가 사건 정보를 수정했을 때
**When** 변경사항을 저장하고 저장 버튼을 클릭하면
**Then** Case 테이블에 변경사항이 저장되고 "사건이 업데이트되었습니다" 메시지가 표시된다
**And** 수정 이력이 기록된다(수정일시, 수정자)

**Given** 변호사가 사건번호를 수정하려고 할 때
**When** 사건번호 필드를 편집하려고 하면
**Then** 사건번호는 수정 불가능한 필드로 표시된다

**Given** 다른 변호사의 사건을 수정하려고 할 때
**When** 수정을 시도하면
**Then** "권한이 없습니다" 에러 메시지가 표시된다

**Requirements:** FR-010

### Story 2.5: 사건 아카이브 처리

As a 변호사,
I want 완료된 사건을 아카이브해서,
So that 활성 사건 목록을 깔끔하게 유지할 수 있다.

**Acceptance Criteria:**

**Given** 변호사가 사건 상세 페이지에 있을 때
**When** "아카이브" 버튼을 클릭하고 확인하면
**Then** 사건의 isArchived 상태가 true로 변경된다
**And** "사건이 아카이브되었습니다" 메시지가 표시된다
**And** 사건 목록 페이지로 리다이렉트된다

**Given** 아카이브된 사건은 기본 목록에서 제외될 때
**When** 사건 목록 페이지를 조회하면
**Then** 아카이브되지 않은 활성 사건만 표시된다

**Given** 변호사가 아카이브된 사건을 조회하고 싶을 때
**When** "아카이브된 사건 보기" 필터를 선택하면
**Then** 아카이브된 모든 사건이 표시된다

**Given** 변호사가 아카이브된 사건을 복원하려고 할 때
**When** "복원" 버튼을 클릭하면
**Then** 사건의 isArchived 상태가 false로 변경된다

**Requirements:** FR-011

### Story 2.6: 사건 메모 관리

As a 변호사,
I want 사건에 메모를 추가하고 관리해서,
So that 사건과 관련된 중요 정보를 기록할 수 있다.

**Acceptance Criteria:**

**Given** 변호사가 사건 상세 페이지에 있을 때
**When** 메모 입력 필드에 내용을 입력하고 추가 버튼을 클릭하면
**Then** CaseNote 테이블에 새 메모가 생성된다
**And** 메모와 함께 작성자, 작성일시가 저장된다
**And** 메모 목록에 새 메모가 표시된다

**Given** 변호사가 메모 목록을 조회할 때
**When** 사건 상세 페이지를 로드하면
**Then** 최신순으로 정렬된 모든 메모가 표시된다
**And** 각 메모에는 작성자 이름, 내용, 작성일시가 표시된다

**Given** 변호사가 자신의 메모를 수정할 때
**When** 메모의 "수정" 버튼을 클릭하고 내용을 변경한 후 저장하면
**Then** 메모 내용이 업데이트되고 "메모가 수정되었습니다" 메시지가 표시된다
**And** 수정일시가 업데이트된다

**Given** 변호사가 자신의 메모를 삭제할 때
**When** 메모의 "삭제" 버튼을 클릭하고 확인하면
**Then** 메모가 CaseNote 테이블에서 삭제되고 "메모가 삭제되었습니다" 메시지가 표시된다

**Given** 다른 변호사의 메모를 수정/삭제하려고 할 때
**When** 수정/삭제 버튼을 클릭하면
**Then** 버튼이 비활성화되어 있거나 "권한이 없습니다" 메시지가 표시된다

**Requirements:** FR-012

---

## Epic 3: 거래내역서 업로드 및 전처리

사용자가 엑셀/CSV/PDF 형식의 거래내역서를 업로드하고 시스템이 자동으로 구조를 분석하여 저장한다.

### Story 3.1: 파일 업로드 UI 및 드래그앤드롭

As a 사용자,
I want 파일을 드래그앤드롭하거나 선택하여 업로드를 시작해서,
So that 쉽게 거래내역서 파일을 업로드할 수 있다.

**Acceptance Criteria:**

**Given** 로그인된 사용자가 사건 상세 페이지에 있을 때
**When** "거래내역서 업로드" 버튼을 클릭하면
**Then** UploadZone 컴포넌트가 표시된다
**And** 드래그앤드롭 영역과 "파일 선택" 버튼이 표시된다

**Given** 사용자가 파일을 드래그앤드롭 영역에 드래그할 때
**When** 파일을 놓으면(drop)
**Then** 파일이 선택되고 업로드 프로세스가 시작된다

**Given** 사용자가 "파일 선택" 버튼을 클릭할 때
**When** 파일 탐색기에서 파일을 선택하면
**Then** 파일이 선택되고 업로드 프로세스가 시작된다

**Given** 사용자가 여러 파일을 동시에 선택할 때
**When** 파일들을 선택하면
**Then** 각 파일이 순차적으로 업로드 대기열에 추가된다

**Requirements:** FR-013, UX Design (UploadZone 컴포넌트)

### Story 3.2: 파일 형식 검증

As a 시스템,
I want 업로드된 파일의 형식을 자동으로 감지하고 검증해서,
So that 지원되지 않는 파일 형식을 조기에 거부할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 파일을 업로드했을 때
**When** 파일이 엑셀(.xlsx, .xls), CSV(.csv), PDF(.pdf) 형식이면
**Then** 파일 형식이 자동으로 감지되고 업로드가 계속 진행된다
**And** 감지된 파일 형식이 사용자에게 표시된다

**Given** 사용자가 지원되지 않는 파일 형식을 업로드했을 때
**When** 파일 형식 검증을 수행하면
**Then** "지원되지 않는 파일 형식입니다. 엑셀, CSV, PDF 파일만 업로드 가능합니다" 에러 메시지가 표시된다
**And** 업로드가 취소된다

**Given** 사용자가 손상된 파일을 업로드했을 때
**When** 파일을 열어서 확인하면
**Then** "파일이 손상되었거나 열 수 없습니다" 에러 메시지가 표시된다

**Given** 사용자가 50MB를 초과하는 파일을 업로드했을 때
**When** 파일 크기를 확인하면
**Then** "파일 크기는 50MB 이하여야 합니다" 에러 메시지가 표시된다

**Requirements:** FR-014, FR-021, NFR-001 (30초 이내 처리)

### Story 3.3: S3 파일 저장 및 메타데이터 관리

As a 시스템,
I want 업로드된 파일을 S3에 저장하고 메타데이터를 DB에 기록해서,
So that 파일을 안전하게 저장하고 추적할 수 있다.

**Acceptance Criteria:**

**Given** 파일 형식 검증이 통과된 파일이 있을 때
**When** 파일 업로드가 시작되면
**Then** 파일은 ap-northeast-2 리전의 AWS S3 버킷에 업로드된다
**And** 파일은 고유한 파일명(UUID)으로 저장된다
**And** 원본 파일명은 메타데이터로 보존된다

**Given** 파일이 S3에 업로드되었을 때
**When** 업로드가 완료되면
**Then** Document 테이블에 파일 메타데이터가 생성된다
**And** 메타데이터에는 원본 파일명, S3 키, 파일 크기, MIME 타입, 업로드일시, 소유자 ID, 연결된 Case ID가 포함된다

**Given** 파일 업로드 중에 네트워크 오류가 발생했을 때
**When** 업로드가 실패하면
**Then** "파일 업로드 중 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지가 표시된다
**And** 부분적으로 업로드된 S3 객체는 삭제된다

**Given** 사용자가 자신의 파일이 아닌 다른 사용자의 파일에 접근하려고 할 때
**When** S3 URL을 통해 직접 접근을 시도하면
**Then** presigned URL이 만료되었거나 권한이 없어 접근이 거부된다

**Requirements:** FR-017, NFR-016 (S3 직접 통합), Architecture (AWS S3 ap-northeast-2)

### Story 3.4: 파일 구조 분석 및 열 식별

As a 시스템,
I want 업로드된 파일의 구조를 분석하여 열을 식별해서,
So that 거래 데이터를 올바르게 추출할 수 있다.

**Acceptance Criteria:**

**Given** 엑셀 또는 CSV 파일이 업로드되었을 때
**When** 파일 구조 분석을 시작하면
**Then** 시스템은 헤더 행을 식별한다
**And** 한글 및 영문 헤더를 모두 지원하여 열을 매핑한다(예: "날짜"/"Date", "입금액"/"Deposit", "출금액"/"Withdrawal")

**Given** 파일의 열 구조를 분석할 때
**When** 시스템이 다음 열을 식별하면
**Then** 날짜(필수), 입금액, 출금액, 잔액, 메모/적요, 거래처 등의 열이 자동으로 매핑된다
**And** 식별된 열 매핑이 사용자에게 표시된다

**Given** 필수 열(날짜)이 식별되지 않았을 때
**When** 구조 분석이 완료되면
**Then** "필수 열(날짜)을 식별할 수 없습니다. 파일을 확인해주세요" 에러 메시지가 표시된다
**And** 사용자는 수동으로 열을 매핑할 수 있는 인터페이스가 제공된다

**Given** PDF 파일이 업로드되었을 때
**When** 구조 분석을 수행하면
**Then** Google Cloud Vision API 또는 Upstage Solar API를 사용하여 텍스트를 추출한다
**And** 추출된 텍스트에서 표 형식을 감지하여 열 구조를 파악한다

**Given** 비표준 형식의 파일이 업로드되었을 때
**When** 자동 열 식별이 실패하면
**Then** 사용자에게 열 매핑 인터페이스가 제공된다
**And** 사용자는 각 열의 의미(날짜, 입금액, 출금액 등)를 수동으로 지정할 수 있다

**Requirements:** FR-015, FR-016, NFR-014 (외부 API 통합)

### Story 3.5: 실시간 진행률 표시 (SSE)

As a 사용자,
I want 대용량 파일 처리 중 진행률을 실시간으로 확인해서,
So that 얼마나 기다려야 하는지 알 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 대용량 파일을 업로드했을 때
**When** 파일 처리가 시작되면
**Then** ProgressBar 컴포넌트가 표시되고 진행률 0%부터 시작한다

**Given** 파일 처리가 진행 중일 때
**When** 서버가 SSE 이벤트를 전송하면
**Then** useRealtimeProgress 훅을 통해 진행률이 실시간으로 업데이트된다
**And** 진행률 퍼센트와 현재 단계(예: "파일 업로드 중...", "구조 분석 중...", "데이터 저장 중...")가 표시된다

**Given** 파일 처리가 완료되었을 때
**When** 100% 진행률에 도달하면
**Then** "파일 업로드가 완료되었습니다" 메시지가 표시된다
**And** 진행률 바는 사라지고 처리된 파일 요약이 표시된다

**Given** 파일 처리 중에 오류가 발생했을 때
**When** 오류가 발생하면
**Then** ProgressBar에 오류 메시지가 표시된다
**And** SSE 연결은 종료된다

**Given** 사용자가 페이지를 새로고침했을 때
**When** 진행 중이던 업로드가 있으면
**Then** 진행률 표시는 초기화되지만 백그라운드 처리는 계속 진행된다

**Requirements:** FR-019, UX Design (ProgressBar, SSE, useRealtimeProgress), Architecture (SSE)

### Story 3.6: 데이터 추출 및 DB 저장

As a 시스템,
I want 파일에서 거래 데이터를 추출하여 DB에 저장해서,
So that 사용자가 분석할 수 있는 정형화된 데이터를 제공한다.

**Acceptance Criteria:**

**Given** 파일 구조 분석이 완료되었을 때
**When** 데이터 추출을 시작하면
**Then** 식별된 열 매핑을 기준으로 각 행의 데이터를 추출한다
**And** 날짜 형식(YYYY-MM-DD, MM/DD/YYYY 등)을 자동으로 변환한다
**And** 금액 필드의 쉼표(,)와 원(₩) 기호를 제거하여 숫자로 변환한다

**Given** 데이터가 추출되었을 때
**When** DB 저장을 시작하면
**Then** 각 거래는 Transaction 테이블에 레코드로 생성된다
**And** 각 레코드에는 caseId, documentId, transactionDate, depositAmount, withdrawalAmount, balance, memo, rawMetadata가 포함된다
**And** 원본 데이터는 rawMetadata(JSON) 필드에 보존된다

**Given** 1,000건의 거래 데이터를 저장할 때
**When** Prisma를 통해 bulk insert를 수행하면
**Then** 모든 데이터가 60초 이내에 저장된다
**And** 저장 성공 메시지가 표시된다

**Given** 데이터 저장 중에 일부 레코드가 실패했을 때
**When** 무효한 날짜나 금액 형식을 만나면
**Then** 해당 레코드는 건너뛰고 처리는 계속된다
**And** 완료 후 "X건의 데이터를 저장했고, Y건은 건너뛰었습니다" 메시지가 표시된다
**And** 건너뛴 레코드는 별도 로그에 기록된다

**Requirements:** FR-017, NFR-002 (1,000건 60초 이내), Architecture (Prisma 7.2.0, Direct Database Access)

### Story 3.7: 업로드 미리보기 및 삭제

As a 사용자,
I want 업로드된 파일 내용을 미리보기하고 삭제해서,
So that 올바른 파일을 업로드했는지 확인하고 잘못 업로드한 파일을 삭제할 수 있다.

**Acceptance Criteria:**

**Given** 파일 업로드가 완료되었을 때
**When** 업로드 완료 화면이 표시되면
**Then** "미리보기" 버튼이 제공된다

**Given** 사용자가 "미리보기" 버튼을 클릭했을 때
**When** 미리보기 모달이 열리면
**Then** 업로드된 파일에서 처음 20건의 거래 데이터가 테이블 형태로 표시된다
**And** 각 행에는 날짜, 입금액, 출금액, 잔액, 메모가 표시된다

**Given** 사용자가 미리보기에서 데이터를 확인했을 때
**When** 데이터가 올바르게 추출되었으면
**Then** "확인" 버튼을 클릭하여 미리보기를 닫을 수 있다
**And** 메인 화면에서 업로드된 파일 목록에 해당 파일이 표시된다

**Given** 사용자가 업로드한 직후 파일을 삭제하고 싶을 때
**When** "삭제" 버튼을 클릭하고 확인하면
**Then** 관련 Transaction 레코드가 모두 삭제된다
**And** Document 레코드가 삭제된다
**And** S3에서 파일이 삭제된다
**And** "파일이 삭제되었습니다" 메시지가 표시된다

**Given** 사용자가 이미 분석이 시작된 파일을 삭제하려고 할 때
**When** "삭제" 버튼을 클릭하면
**Then** "이미 분석이 시작된 파일은 삭제할 수 없습니다" 경고 메시지가 표시된다

**Requirements:** FR-019, FR-020

---

## Epic 4: AI 기반 거래 분류

시스템이 AI로 각 거래를 자동 분류하고, 사용자가 수동으로 수정하며 태그를 관리할 수 있다.

### Story 4.1: AI 기반 거래 자동 분류

As a 시스템,
I want AI를 사용하여 각 거래를 분류하고 태그를 부여해서,
So that 사용자가 거래의 성격을 빠르게 이해할 수 있다.

**Acceptance Criteria:**

**Given** 거래 데이터가 DB에 저장되었을 때
**When** AI 분류를 시작하면
**Then** Upstage Solar API, OpenAI GPT, 또는 Anthropic Claude를 호출하여 각 거래를 분류한다
**And** 거래의 메모(memo) 필드를 기반으로 분류를 수행한다

**Given** AI가 거래를 분류할 때
**When** 분류가 완료되면
**Then** 각 거래에는 태그가 부여된다(입금, 출금, 이체, 수수료, 기타 등)
**And** 분류 결과는 Transaction 테이블의 category, subcategory 필드에 저장된다

**Given** 1,000건의 거래를 분류할 때
**When** AI API 호출을 수행하면
**Then** 모든 거래가 60초 이내에 분류된다
**And** 분류 완료 메시지가 표시된다

**Given** AI API 호출이 실패했을 때
**When** 재시도 메커니즘이 작동하면
**Then** 최대 3회까지 재시도를 수행한다
**And** 재시도가 모두 실패하면 "AI 분류에 실패했습니다. 나중에 다시 시도해주세요" 메시지가 표시된다

**Requirements:** FR-022, FR-023, NFR-002 (1,000건 60초), NFR-015 (재시도), NFR-014 (외부 API)

### Story 4.2: 신뢰도 점수 및 불확실한 분류 표시

As a 시스템,
I want 신뢰도 점수를 제공하고 불확실한 분류를 표시해서,
So that 사용자가 검토가 필요한 거래를 식별할 수 있다.

**Acceptance Criteria:**

**Given** AI가 거래를 분류했을 때
**When** 각 거래의 분류 결과를 저장하면
**Then** confidenceScore 필드(0~1 사이의 값)가 함께 저장된다

**Given** 신뢰도 점수가 0.7 미만인 거래가 있을 때
**When** 분류 결과를 표시하면
**Then** 해당 거래는 "불확실한 분류"로 표시된다
**And** 시각적으로 구분되어 표시된다(예: 🟡 아이콘 또는 배경색)

**Given** 사용자가 불확실한 분류만 필터링하고 싶을 때
**When** "신뢰도 낮은 순" 필터를 적용하면
**Then** confidenceScore가 낮은 순서대로 거래가 정렬된다

**Given** 사용자가 거래 상세를 조회할 때
**When** 특정 거래를 클릭하면
**Then** 분류 카테고리와 함께 신뢰도 점수가 퍼센트로 표시된다(예: "입금 - 92% 신뢰도")

**Requirements:** FR-024

### Story 4.3: 중요 거래 자동 식별

As a 시스템,
I want 대출 실행, 변제, 담보제공 등 중요 거래를 자동 식별해서,
So that 사용자가 중요한 거래를 놓치지 않는다.

**Acceptance Criteria:**

**Given** AI가 거래를 분류할 때
**When** 메모에 특정 키워드가 포함되어 있으면
**Then** 해당 거래는 "중요 거래"로 표시된다
**And** importantTransaction 플래그가 true로 설정된다

**Given** 중요 거래 키워드가 정의되어 있을 때
**When** 메모에 다음 키워드가 포함되어 있으면
**Then** 해당 중요 거래 유형으로 태그된다:
  - 대출 실행, 대출금, 실행
  - 변제, 상환, 갚음
  - 담보제공, 담보설정, 저당권
  - 압류, 가압류

**Given** 중요 거래가 식별되었을 때
**When** TransactionTable에 거래가 표시되면
**Then** 중요 거래는 시각적으로 강조되어 표시된다(예: 🔴 배경 또는 아이콘)
**And** FindingCard로 발견사항 목록에도 추가된다

**Given** 사용자가 중요 거래만 필터링하고 싶을 때
**When** "중요 거래만 보기" 필터를 활성화하면
**Then** importantTransaction이 true인 거래만 표시된다

**Requirements:** FR-025

### Story 4.4: 거래 성격 판단

As a 시스템,
I want 거래의 성격(채권자 관련, 담보 관련, 우선변제 관련)을 판단해서,
So that 파산 사건의 핵심 쟁점을 식별할 수 있다.

**Acceptance Criteria:**

**Given** AI가 거래를 분석할 때
**When** 거래의 메모와 금액, 날짜를 분석하면
**Then** 거래의 성격을 다음 카테고리로 분류한다:
  - 채권자 관련 (채권자 명시, 채권 회수 관련)
  - 담보 관련 (담보권 설정, 변경, 소멸)
  - 우선변제 관련 (우선변제권 침해 가능성)
  - 일반 거래 (위에 해당하지 않음)

**Given** 채권자 관련 거래가 식별되었을 때
**When** 분류가 완료되면
**Then** transactionNature 필드가 "CREDITOR"로 설정된다
**And** 메모에서 추출된 채권자명이 creditorName 필드에 저장된다

**Given** 담보 관련 거래가 식별되었을 때
**When** 분류가 완료되면
**Then** transactionNature 필드가 "COLLATERAL"로 설정된다
**And** 담보 유형(저당권, 질권, 유치권 등)이 collateralType 필드에 저장된다

**Given** 우선변제 관련 거래가 식별되었을 때
**When** 분류가 완료되면
**Then** transactionNature 필드가 "PRIORITY_REPAYMENT"로 설정된다
**And** 해당 거래는 발견사항으로 표시되어 경고가 표시된다

**Given** 사용자가 특정 성격의 거래만 필터링하고 싶을 때
**When** transactionNature 필터를 적용하면
**Then** 해당 성격의 거래만 표시된다

**Requirements:** FR-026

### Story 4.5: 수동 분류 수정

As a 사용자,
I want AI 분류 결과를 수동으로 수정해서,
So that 잘못된 분류를 정정할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable에서 거래를 조회할 때
**When** 특정 거래의 카테고리 셀을 클릭하면
**Then** 드롭다운 메뉴가 표시되고 다른 카테고리를 선택할 수 있다

**Given** 사용자가 카테고리를 변경했을 때
**When** 새 카테고리를 선택하고 확인하면
**Then** Transaction 레코드의 category, subcategory 필드가 업데이트된다
**And** confidenceScore는 1.0(100%)로 설정된다(사용자 수동 수정)
**And** isManuallyClassified 플래그가 true로 설정된다

**Given** 사용자가 수정 내역을 확인하고 싶을 때
**When** 거래 상세를 조회하면
**Then** "수정됨" 배지가 표시되고 원본 AI 분류 결과와 수정 일시가 표시된다

**Given** 사용자가 분류 수정을 취소하고 싶을 때
**When** "원본 복원" 버튼을 클릭하면
**Then** 원본 AI 분류 결과가 복원된다
**And** isManuallyClassified 플래그가 false로 변경된다

**Requirements:** FR-027

### Story 4.6: 태그 추가 및 삭제

As a 사용자,
I want 태그를 추가하거나 삭제해서,
So that 거래를 더 세분화하여 분류할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable에서 거래를 선택했을 때
**When** "태그 관리" 버튼을 클릭하면
**Then** 현재 거래의 태그 목록이 표시되고 태그 추가/삭제 인터페이스가 제공된다

**Given** 사용자가 새 태그를 추가할 때
**When** 태그 이름을 입력하고 추가 버튼을 클릭하면
**Then** 새 태그가 TransactionTag 테이블에 생성되고 현재 거래와 연결된다
**And** 태그 목록에 새 태그가 표시된다

**Given** 사용자가 기존 태그를 삭제할 때
**When** 태그 옆의 "x" 버튼을 클릭하면
**Then** 태그와 거래의 연결이 해제된다
**And** 태그 목록에서 제거된다

**Given** 사용자가 자주 사용하는 태그를 재사용하고 싶을 때
**When** 태그 입력 필드에 텍스트를 입력하면
**Then** 자동 완성으로 기존 태그들이 추천된다
**And** 추천 태그를 선택하면 빠르게 태그를 추가할 수 있다

**Given** 사용자가 여러 거래에 동일한 태그를 추가하고 싶을 때
**When** 여러 거래를 선택하고 "일괄 태그 추가"를 클릭하면
**Then** 선택된 모든 거래에 동일한 태그가 추가된다

**Requirements:** FR-028

### Story 4.7: 일괄 분류 및 수정

As a 사용자,
I want 여러 거래를 일괄적으로 분류하거나 수정해서,
So that 효율적으로 거래를 관리할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable에서 여러 거래를 선택했을 때
**When** 체크박스를 사용하여 거래들을 선택하면
**Then** "일괄 수정" 버튼이 활성화된다

**Given** 사용자가 "일괄 수정" 버튼을 클릭했을 때
**When** 일괄 수정 모달이 열리면
**Then** 카테고리 변경, 태그 추가, 중요 거래 표시 등의 옵션이 제공된다

**Given** 사용자가 카테고리를 일괄 변경할 때
**When** 새 카테고리를 선택하고 적용 버튼을 클릭하면
**Then** 선택된 모든 거래의 category가 변경된다
**And** 모든 거래의 isManuallyClassified가 true로 설정된다
**And** "X건의 거래가 수정되었습니다" 메시지가 표시된다

**Given** 사용자가 태그를 일괄 추가할 때
**When** 태그 이름을 입력하고 적용 버튼을 클릭하면
**Then** 선택된 모든 거래에 해당 태그가 추가된다

**Given** 사용자가 중요 거래로 일괄 표시할 때
**When** "중요 거래로 표시" 옵션을 선택하고 적용하면
**Then** 선택된 모든 거래의 importantTransaction이 true로 설정된다

**Requirements:** FR-031

### Story 4.8: 학습 피드백 루프

As a 시스템,
I want 사용자의 수정을 학습하여 향후 분류 정확도를 높여서,
So that 시간이 지날수록 AI 분류가 개선된다.

**Acceptance Criteria:**

**Given** 사용자가 AI 분류를 수동 수정했을 때
**When** 수정이 저장되면
**Then** ClassificationFeedback 테이블에 피드백 레코드가 생성된다
**And** 원본 AI 분류, 사용자 수정, 거래 데이터가 저장된다

**Given** 피드백 데이터가 축적되었을 때
**When** 주기적으로(매주) 학습 작업이 실행되면
**Then** 피드백 데이터를 사용하여 AI 분류 모델이 파인 튜닝된다
**And** 새로운 분류 규칙이 추출되어 ClassificationRule 테이블에 저장된다

**Given** 새로운 분류 규칙이 생성되었을 때
**When** 향후 거래 분류를 수행하면
**Then** 새 규칙이 먼저 적용되고, 규칙이 없는 경우에만 AI API가 호출된다

**Given** 관리자가 학습 통계를 확인하고 싶을 때
**When** 관리자 대시보드에서 "AI 학습 통계"를 조회하면
**Then** 총 피드백 수, 분류 정확도 개선 추이, 가장 많이 수정된 카테고리 등이 표시된다

**Given** 사용자가 AI 분류에 만족하지 않을 때
**When** "분류 오류 보고" 버튼을 클릭하면
**Then** 오류 유형과 설명을 입력할 수 있는 폼이 표시된다
**And** 제출된 오류 보고는 ClassificationError 테이블에 저장되어 개선에 활용된다

**Requirements:** FR-029, FR-030

---

## Epic 5: 자금 흐름 추적

사용자가 특정 거래의 자금 출처와 사용처를 추적하고 관련 거래 간 연결고리를 시각화한다.

### Story 5.1: 자금 출처 추적

As a 사용자,
I want 특정 거래의 자금 출처를 거슬러 올라가서 추적해서,
So that 자금이 어디서 유입되었는지 파악할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable에서 특정 입금 거래를 선택했을 때
**When** "자금 출처 추적" 버튼을 클릭하면
**Then** 해당 금액과 일치하거나 유사한 출금 거래들을 검색한다
**And** 검색 조건: 금액이 ±10% 이내, 날짜가 추적 대상 거래 이전

**Given** 자금 출처가 식별되었을 때
**When** 추적 결과가 표시되면
**Then** 연관된 출금 거래들이 목록으로 표시된다
**And** 각 거래에는 연관 강도(금액 일치도, 날짜 근접도)가 표시된다

**Given** 다단계 추적이 필요할 때
**When** "계속 추적" 버튼을 클릭하면
**Then** 식별된 출금 거래의 출처를 다시 추적한다
**And** 최대 5단계까지 거슬러 올라간다

**Given** 추적 결과가 없을 때
**When** 검색이 완료되면
**Then** "자금 출처를 찾을 수 없습니다" 메시지가 표시된다

**Requirements:** FR-032, NFR-003 (3초 이내 응답)

### Story 5.2: 자금 사용처 추적

As a 사용자,
I want 특정 거래의 자금이 어디로 흘러갔는지 추적해서,
So that 자금의 최종 사용처를 파악할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable에서 특정 출금 거래를 선택했을 때
**When** "자금 사용처 추적" 버튼을 클릭하면
**Then** 해당 금액과 일치하거나 유사한 입금 거래들을 검색한다
**And** 검색 조건: 금액이 ±10% 이내, 날짜가 추적 대상 거래 이후

**Given** 자금 사용처가 식별되었을 때
**When** 추적 결과가 표시되면
**Then** 연관된 입금 거래들이 목록으로 표시된다
**And** 각 거래에는 연관 강도가 표시된다

**Given** 자금이 분리되어 사용되었을 때
**When** 여러 입금 거래가 식별되면
**Then** 합계 금액이 원본 출금액과 근접한지 확인한다
**And** "자금이 여러 곳으로 분리되었습니다" 메시지가 표시된다

**Given** 다단계 추적이 필요할 때
**When** "계속 추적" 버튼을 클릭하면
**Then** 식별된 입금 거래의 사용처를 다시 추적한다
**And** 최대 5단계까지 추적한다

**Requirements:** FR-033, NFR-003 (3초 이내 응답)

### Story 5.3: 거래 체인 식별

As a 시스템,
I want 연관된 거래들 간의 체인을 식별해서,
So that 복잡한 자금 흐름을 파악할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 "자금 흐름 분석"을 시작했을 때
**When** 사건의 모든 거래를 분석하면
**Then** 시스템은 다음 패턴의 체인을 자동 식별한다:
  - 대출 실행 → 자금 이체 → 담보제공
  - 채무 변제 → 자금 출처 → 정산 거래
  - 담보권 설정 → 자금 유입 → 담보권 해지

**Given** 거래 체인이 식별되었을 때
**When** 체인 분석이 완료되면
**Then** TransactionChain 테이블에 체인 정보가 저장된다
**And** 각 체인에는 chainType, involvedTransactionIds, confidenceScore가 포함된다

**Given** 사용자가 식별된 체인을 조회할 때
**When** "체인 보기"를 클릭하면
**Then** 체인에 포함된 모든 거래들이 순서대로 표시된다
**And** 각 거래 간의 관계(출처/사용처)가 화살표로 표시된다

**Given** 체인 식별의 신뢰도가 낮을 때
**When** confidenceScore가 0.6 미만이면
**Then** "불확실한 체인입니다. 검토가 필요합니다" 경고가 표시된다

**Requirements:** FR-035

### Story 5.4: 연결고리 시각화

As a 사용자,
I want 관련 거래 간의 연결고리를 그래프 형태로 시각화해서,
So that 자금 흐름을 직관적으로 이해할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 자금 흐름 추적을 실행했을 때
**When** 추적 결과가 준비되면
**Then** 그래프 시각화 모달이 표시된다
**And** 각 거래는 노드(node)로, 자금 흐름은 엣지(edge)로 표시된다

**Given** 그래프가 표시될 때
**When** 사용자가 특정 노드를 클릭하면
**Then** 해당 거래의 상세 정보가 표시된다
**And** 연결된 노드들이 하이라이트된다

**Given** 그래프가 복잡할 때
**When** 사용자가 줌 인/아웃을 하면
**Then** 그래프가 확대/축소된다
**And** 팬닝(panning)으로 그래프를 이동할 수 있다

**Given** 사용자가 특정 체인만 보고 싶을 때
**When** 사이드바에서 체인 유형을 선택하면
**Then** 해당 체인에 속한 거래들만 필터링되어 표시된다

**Given** 사용자가 시각화 레이아웃을 변경하고 싶을 때
**When** 레이아웃 옵션(트리, 원형, 히어라키)을 선택하면
**Then** 그래프가 해당 레이아웃으로 재배치된다

**Requirements:** FR-034

### Story 5.5: 추적 필터링

As a 사용자,
I want 추적 범위를 날짜, 금액, 태그 등으로 필터링해서,
So that 관심 있는 자금 흐름만 집중해서 볼 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 자금 흐름 추적 화면에 있을 때
**When** FilterPanel이 표시되면
**Then** 다음 필터 옵션이 제공된다:
  - 날짜 범위 (시작일, 종료일)
  - 금액 범위 (최소금액, 최대금액)
  - 태그 (다중 선택 가능)
  - 거래 성격 (채권자/담보/우선변제)
  - 중요 거래만 보기

**Given** 사용자가 날짜 범위를 필터링할 때
**When** 시작일과 종료일을 설정하면
**Then** 해당 기간 내의 거래들만 추적 대상에 포함된다

**Given** 사용자가 금액 범위를 필터링할 때
**When** 최소금액과 최대금액을 설정하면
**Then** 해당 범위 내의 금액을 가진 거래들만 추적된다

**Given** 사용자가 태그를 필터링할 때
**When** 특정 태그들을 선택하면
**Then** 해당 태그가 있는 거래들만 추적된다
**And** 여러 태그는 OR 조건으로 적용된다

**Given** 사용자가 복합 필터를 적용할 때
**When** 여러 필터를 동시에 적용하면
**Then** 모든 조건을 만족하는 거래들만 추적된다(AND 조건)

**Given** 사용자가 필터를 저장하고 싶을 때
**When** "필터 저장" 버튼을 클릭하면
**Then** 현재 필터 조합이 저장되고 다음에 빠르게 불러올 수 있다

**Requirements:** FR-036

### Story 5.6: 추적 결과 내보내기

As a 사용자,
I want 자금 흐름 추적 결과를 엑셀로 내보내서,
So that 보고서나 증거 자료로 활용할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 자금 흐름 추적을 완료했을 때
**When** "내보내기" 버튼을 클릭하면
**Then** 내보내기 옵션 모달이 표시된다

**Given** 사용자가 내보내기 옵션을 선택할 때
**When** 다음 옵션 중 하나를 선택하면:
  - 체인 전체 내보내기
  - 현재 필터링된 결과만 내보내기
  - 선택된 거래들만 내보내기
**Then** 해당 범위의 데이터가 엑셀 파일로 생성된다

**Given** 엑셀 파일이 생성될 때
**When** 파일 생성이 완료되면
**Then** 엑셀에는 다음 시트가 포함된다:
  - 요약 시트: 추적 개요, 총 거래 수, 총 금액
  - 거래 상세 시트: 각 거래의 상세 정보
  - 체인 시트: 식별된 거래 체인 정보
  - 시각화 시트: 그래프 이미지 캡처

**Given** 사용자가 엑셀 파일을 다운로드했을 때
**When** 다운로드가 완료되면
**Then** "엑셀 파일이 다운로드되었습니다" 메시지가 표시된다
**And** 파일명은 "자금흐름추적_[사건번호]_[날짜].xlsx" 형식이다

**Requirements:** FR-037

---

## Epic 6: 발견 사항 관리

시스템이 파산 사건과 관련된 중요 발견사항을 자동 식별하고 사용자가 메모를 추가하며 채권자별로 필터링할 수 있다.

### Story 6.1: 자동 발견사항 식별

As a 시스템,
I want 파산 사건과 관련된 중요 발견사항을 자동 식별해서,
So that 사용자가 중요한 이슈를 놓치지 않는다.

**Acceptance Criteria:**

**Given** AI가 거래를 분석했을 때
**When** 다음 패턴이 감지되면
**Then** Finding 테이블에 발견사항 레코드가 생성된다:
  - 선의성/악의성 판단 관련 거래 (대출 실행 후 짧은 기간 내 담보제공)
  - 우선변제권 침해 가능성 (우선변제권자가 있음에도 불구하고 다른 채권자에게 변제)
  - 담보권 설정/변경/소멸 관련 거래

**Given** 발견사항이 생성될 때
**When** Finding 레코드가 저장되면
**Then** findingType, severity, description, relatedTransactionIds, relatedCreditorNames가 포함된다
**And** severity는 CRITICAL, WARNING, INFO 중 하나로 자동 분류된다

**Given** 선의성/악의성 관련 발견사항이 식별될 때
**When** 대출 실행 후 30일 이내 담보제공이 감지되면
**Then** severity는 CRITICAL으로 설정되고 "악의성 의심: 대출 후 짧은 기간 내 담보제공" 메시지가 생성된다

**Given** 우선변제권 침해가 식별될 때
**When** 우선변제권 채권자가 있음에도 일반 채권자에게 먼저 변제가 감지되면
**Then** severity는 CRITICAL으로 설정되고 "우선변제권 침해 가능성" 메시지가 생성된다

**Requirements:** FR-038, FR-039, FR-040, FR-041

### Story 6.2: 발견사항 시각적 표시

As a 사용자,
I want 발견사항이 색상 코딩으로 시각적으로 표시되어서,
So that 중요도를 빠르게 인지할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 사건 분석 화면에 접근했을 때
**When** 발견사항이 존재하면
**Then** Split View 레이아웃의 왼쪽 40%에 FindingCard 목록이 표시된다

**Given** FindingCard가 표시될 때
**When** severity에 따라 색상이 표시된다:
  - 🔴 CRITICAL: red-600 배경색
  - 🟡 WARNING: amber-600 배경색
  - 🟠 INFO: orange-600 배경색

**Given** 사용자가 특정 FindingCard를 클릭했을 때
**When** 클릭하면
**Then** 관련된 거래들이 TransactionTable에서 하이라이트된다
**And** 발견사항 상세 모달이 표시된다

**Given** 발견사항이 많을 때
**When** severity별로 그룹화되어 표시되면
**Then** CRITICAL이 가장 먼저 표시되고, 그 다음 WARNING, INFO 순으로 표시된다

**Requirements:** FR-038, UX Design (FindingCard, 색상 코딩)

### Story 6.3: 발견사항 메모 추가

As a 사용자,
I want 발견사항에 메모를 추가하고 관리해서,
So that** 검토 의견이나 향후 조치사항을 기록할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 FindingCard를 클릭했을 때
**When** 발견사항 상세 모달이 열리면
**Then** "메모 추가" 입력 필드와 버튼이 제공된다

**Given** 사용자가 메모를 추가할 때
**When** 메모 내용을 입력하고 추가 버튼을 클릭하면
**Then** FindingNote 테이블에 메모 레코드가 생성된다
**And** 메모 목록에 새 메모가 표시된다
**And** 메모와 함께 작성자와 작성일시가 저장된다

**Given** 사용자가 메모를 수정할 때
**When** 메모의 "수정" 버튼을 클릭하고 내용을 변경하면
**Then** 메모가 업데이트되고 수정일시가 기록된다

**Given** 사용자가 메모를 삭제할 때
**When** 메모의 "삭제" 버튼을 클릭하고 확인하면
**Then** 메모가 FindingNote 테이블에서 삭제된다

**Requirements:** FR-042

### Story 6.4: 채권자별 필터링

As a 사용자,
I want 발견사항을 채권자별로 필터링해서,
So that** 특정 채권자와 관련된 이슈를 집중해서 볼 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 발견사항 목록을 조회할 때
**When** FilterPanel에 "채권자별 필터" 옵션이 제공되면
**Then** 사건과 관련된 모든 채권자명 목록이 다중 선택 가능한 체크박스로 표시된다

**Given** 사용자가 특정 채권자를 선택할 때
**When** 채권자명을 체크하면
**Then** 해당 채권자가 언급된 발견사항만 필터링되어 표시된다
**And** relatedCreditorNames 필드에 선택된 채권자명이 포함된 Finding 레코드만 표시된다

**Given** 사용자가 여러 채권자를 선택할 때
**When** 2명 이상의 채권자를 체크하면
**Then** 선택된 채권자 중 하나라도 관련된 발견사항이 모두 표시된다(OR 조건)

**Given** 사용자가 채권자 필터를 저장할 때
**When** "필터 저장"을 클릭하면
**Then** 현재 채권자 필터 조합이 저장되고 나중에 빠르게 불러올 수 있다

**Requirements:** FR-043

### Story 6.5: 중요도 지정

As a 사용자,
I want 발견사항의 중요도를 지정하고 정렬해서,
So that** 가장 중요한 이슈부터 검토할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 발견사항을 조회할 때
**When** 각 FindingCard에 중요도 선택 드롭다운이 제공되면
**Then** 높음, 중간, 낮음 중 하나를 선택할 수 있다

**Given** 사용자가 중요도를 변경할 때
**When** 드롭다운에서 새 중요도를 선택하면
**Then** Finding 레코드의 priority 필드가 업데이트된다(HIGH, MEDIUM, LOW)

**Given** 사용자가 중요도순으로 정렬하고 싶을 때
**When** "중요도순 정렬" 옵션을 선택하면
**Then** HIGH → MEDIUM → LOW 순으로 발견사항이 정렬된다
**And** 같은 중요도 내에서는 자동 생성된 severity(CRITICAL > WARNING > INFO) 순으로 정렬된다

**Given** 사용자가 사용자 지정 중요도를 보고 싶을 때
**When** "사용자 지정 중요도만 보기" 필터를 활성화하면
**Then** priority가 NULL이 아닌 발견사항만 표시된다
**And** 자동으로 식별된 발견사항(priority=NULL)은 숨겨진다

**Requirements:** FR-044

---

## Epic 7: 분석 결과 내보내기

사용자가 분석 결과, 거래 목록, 발견사항, 자금 흐름 추적 결과를 엑셀 형식으로 내보낸다.

### Story 7.1: 엑셀 내보내기 기능 구현

As a 사용자,
I want 분석 결과를 엑셀 형식으로 내보내서,
So that** 보고서나 증거 자료로 활용할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 사건 분석 화면에 있을 때
**When** "내보내기" 버튼을 클릭하면
**Then** 내보내기 옵션 모달이 표시된다

**Given** 사용자가 내보내기 옵션을 선택할 때
**When** "전체 분석 결과 내보내기"를 선택하면
**Then** 다음 내용이 포함된 엑셀 파일이 생성된다:
  - 사건 기본 정보 시트
  - 거래 내역 시트 (모든 거래)
  - 발견사항 시트
  - AI 분류 요약 시트

**Given** 엑셀 파일이 생성될 때
**When** 파일 생성이 완료되면
**Then** 파일은 UTF-8 인코딩으로 저장되고 한글이 올바르게 표시된다
**And** 셀 서식(날짜, 통화 등)이 적용된다

**Given** 사용자가 다운로드를 시작했을 때
**When** 다운로드가 완료되면
**Then** "엑셀 파일이 다운로드되었습니다" 메시지가 표시된다
**And** 파일명은 "분석결과_[사건번호]_[날짜].xlsx" 형식이다

**Requirements:** FR-045

### Story 7.2: 선택적 거래 목록 내보내기

As a 사용자,
I want 특정 거래 목록을 선택하여 내보내서,
So that** 필요한 거래만 추려서 보고서를 만들 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable에서 거래들을 선택했을 때
**When** 체크박스로 원하는 거래들을 선택하고 "선택 내보내기"를 클릭하면
**Then** 선택된 거래들만 포함된 엑셀 파일이 생성된다

**Given** 사용자가 필터링된 결과를 내보낼 때
**When** 현재 적용된 필터 조건이 있을 때
**When** "현재 필터 결과 내보내기"를 클릭하면
**Then** 필터링된 거래들만 엑셀로 생성된다
**And** 엑셀의 첫 행에 적용된 필터 조건이 주석으로 표시된다

**Given** 사용자가 내보내기 옵션을 설정할 때
**When** "포함할 열 선택" 옵션을 제공하면
**Then** 사용자는 엑셀에 포함할 열(날짜, 입금액, 출금액, 메모, 태그 등)을 선택할 수 있다

**Requirements:** FR-046

### Story 7.3: 발견사항 목록 내보내기

As a 사용자,
I want 발견사항 목록을 엑셀로 내보내서,
So that** 발견사항 보고서를 만들 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 발견사항 목록을 조회할 때
**When** "발견사항 내보내기" 버튼을 클릭하면
**Then** 모든 발견사항이 포함된 엑셀 파일이 생성된다

**Given** 엑셀 파일에 발견사항이 포함될 때
**When** 각 발견사항 행에는 다음 정보가 포함된다:
  - 발견사항 ID
  - 유형 (선의성/악의성, 우선변제권 침해, 담보권 등)
  - 중요도 (CRITICAL/WARNING/INFO)
  - 설명
  - 관련 거래 ID
  - 관련 채권자명
  - 사용자 메모
  - 생성일시

**Given** 엑셀 파일 생성 시
**When** severity별로 색상이 적용되면
**Then** CRITICAL은 빨간색 배경, WARNING은 노란색 배경, INFO는 주황색 배경이 적용된다

**Requirements:** FR-047

### Story 7.4: 자금 흐름 추적 결과 내보내기

As a 사용자,
I want 자금 흐름 추적 결과를 엑셀로 내보내서,
So that** 자금 흐름 보고서를 만들 수 있다.

**Requirements:** FR-048

**참고:** Epic 5.6 "추적 결과 내보내기" Story와 중복되므로 해당 Story를 참조하여 구현한다.

---

## Epic 8: 검색 및 필터링

사용자가 거래내역을 다양한 조건(날짜, 금액, 키워드, 태그)으로 검색하고 여러 필터 조합으로 조회한다.

### Story 8.1: 다차원 검색 구현

As a 사용자,
I want 거래내역을 다양한 조건으로 검색해서,
So that** 원하는 거래를 빠르게 찾을 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 TransactionTable 화면에 있을 때
**When** 검색 입력 필드에 텍스트를 입력하면
**Then** 메모 필드에서 해당 키워드를 포함하는 거래들이 실시간으로 필터링된다
**And** 검색은 대소문자를 구분하지 않는다

**Given** 사용자가 날짜로 검색할 때
**When** 시작일과 종료일을 선택하면
**Then** 해당 기간 내의 거래들만 표시된다

**Given** 사용자가 금액으로 검색할 때
**When** 최소금액과 최대금액을 입력하면
**Then** 입금액 또는 출금액이 해당 범위 내인 거래들만 표시된다

**Given** 사용자가 태그로 검색할 때
**When** 특정 태그를 선택하면
**Then** 해당 태그가 있는 거래들만 표시된다
**And** 여러 태그 선택 시 OR 조건으로 적용된다

**Given** 검색 결과가 없을 때
**When** 일치하는 거래가 없으면
**Then** "검색 결과가 없습니다" 메시지가 표시된다

**Given** 검색을 실행할 때
**When** 검색 쿼리가 실행되면
**Then** 3초 이내에 결과가 표시된다(NFR-003)

**Requirements:** FR-049, NFR-003 (3초 이내 응답)

### Story 8.2: 복합 필터링 구현

As a 사용자,
I want 여러 필터를 조합하여 거래내역을 조회해서,
So that** 정교한 검색을 수행할 수 있다.

**Acceptance Criteria:**

**Given** 사용자가 FilterPanel을 열었을 때
**When** 다음 필터 옵션이 제공되면:
  - 날짜 범위
  - 금액 범위
  - 키워드 (메모 검색)
  - 태그 (다중 선택)
  - 거래 유형 (입금/출금/이체)
  - 거래 성격 (채권자/담보/우선변제)
  - 중요 거래만
  - AI 신뢰도 범위

**Given** 사용자가 여러 필터를 동시에 적용할 때
**When** 2개 이상의 필터를 설정하고 "적용"을 클릭하면
**Then** 모든 필터 조건을 만족하는 거래들만 표시된다(AND 조건)
**And** 각 필터 옆에 현재 적용된 값이 표시된다

**Given** 사용자가 필터를 저장할 때
**When** "필터 저장" 버튼을 클릭하고 이름을 입력하면
**Then** 현재 필터 조합이 SavedFilter 테이블에 저장된다
**And** 저장된 필터는 드롭다운에서 빠르게 불러올 수 있다

**Given** 사용자가 저장된 필터를 불러올 때
**When** 저장된 필터를 선택하면
**Then** 해당 필터 조합이 자동으로 적용된다

**Given** 사용자가 모든 필터를 초기화하고 싶을 때
**When** "필터 초기화" 버튼을 클릭하면
**Then** 모든 필터가 리셋되고 전체 거래가 표시된다

**Given** 복잡한 필터가 적용되었을 때
**When** 쿼리가 실행되면
**Then** 3초 이내에 결과가 표시된다(NFR-003)

**Requirements:** FR-050, NFR-003 (3초 이내 응답)
