# Epic 1 Retrospective: 사용자 인증 및 프로필 관리

**날짜:** 2026-01-08
**Epic:** Epic 1 - 사용자 인증 및 프로필 관리
**참여자:** Soonseek (Project Lead), Alice (Product Owner), Bob (Scrum Master), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

---

## Epic 요약

### 전달 메트릭스

- **완료된 스토리:** 4/4 (100%)
  - Story 1.1: 사용자 회원가입 ✅
  - Story 1.2: 사용자 로그인 및 로그아웃 ✅
  - Story 1.3: 비밀번호 찾기 및 재설정 ✅
  - Story 1.4: 사용자 프로필 관리 ✅
- **상태:** 모든 스토리 done

### 품질 및 기술

- **해결된 리뷰 이슈:** 10+ 개
  - HIGH priority bug: updateEmail mutation (pendingEmail 필드로 해결)
  - MEDIUM priority issue: AuthContext 사용 최적화
  - CRITICAL 보안 이슈: JWT 인증 시스템 전반 (tokenVersion, rate limiting, CSRF 방지)
- **구현된 보안 기능:**
  - ✅ JWT Access Token (15분) + Refresh Token (8시간)
  - ✅ tokenVersion rotation (보안 강화)
  - ✅ Refresh Token DB 저장 및 로그아웃 시 무효화
  - ✅ Rate Limiting (login endpoint)
  - ✅ bcrypt 비밀번호 해싱
  - ✅ 이메일 인증 (verification token)

### 비즈니스 결과

- **달성된 요구사항:** FR-001, FR-002, FR-003, FR-004, FR-005 (인증 관련 모든 요구사항)
- **보안 요구사항:** NFR-006 (HTTPS/TLS), NFR-007 (bcrypt), NFR-009 (JWT)
- **이해관계자 피드백:** 없음 (개발 환경)

---

## 잘된 점 (Successes)

### 1. JWT 인증 시스템 우수한 구현

**Alice (Product Owner):** "JWT 인증 시스템이 제 기대를 훨씬 넘어섰어요. tokenVersion rotation, refresh token DB 저장, rate limiting까지 완벽하게 구현되었습니다."

- tokenVersion으로 모든 refresh tokens 무효화
- Refresh Token DB 저장으로 로그아웃 지원
- Rate limiting으로 brute force attack 방지
- Access Token 15분, Refresh Token 8시간으로 적절한 균형

### 2. 코드 리뷰의 효과

**Dana (QA Engineer):** "코드 리뷰가 매우 철저했습니다. 10개 이상의 리뷰 이슈를 발견하고 모두 해결했어요."

- 4개 스토리 모두에서 코드 리뷰 실행
- CRITICAL 버그 발견 및 수정 (updateEmail mutation)
- 보안 취약점 조기 발견 (XSS, CSRF)
- AuthContext 사용 최적화

### 3. Bug 수정의 우수사례

**Charlie (Senior Dev):** "Story 1.4에서 발견한 updateEmail bug를 pendingEmail 필드로 해결한 것은 정말 좋았어요."

- **문제:** updateEmail mutation이 email을 실제로 변경하지 않음 (critical bug)
- **해결:** pendingEmail 필드 추가, verifyEmail에서 처리 로직 구현
- **결과:** 이메일 변경 flow 완전히 작동

### 4. 팀 협업

**Elena (Junior Dev):** "Charlie가 코드 리뷰 후 authUser 활용하도록 수정해준 덕분에 프로필 페이지가 훨씬 최적화되었어요."

- Senior Dev가 Junior Dev 멘토링
- 코드 리뷰를 학습 기회로 활용
- 팀 전체가 보안에 대한 인식 공유

---

## 어려웠던 점 (Challenges)

### 1. 보안 요구사항의 복잡성

**Elena (Junior Dev):** "Story 1.1에서 JWT 인증 구현할 때가 좀 힘들었어요. 처음에는 localStorage를 썼는데, XSS 취약점 때문에 sessionStorage로 변경하고, 결국에는 HttpOnly Cookie도 고민해야 했거든요."

**Root Cause:**
- 초기에 명확한 보안 표준이 없음
- 개발 중간에 보안 요구사항이 변경/추가됨
- localStorage → sessionStorage → HttpOnly Cookie 논의

**해결 방안:**
- 사용자 결정: sessionStorage 사용 유지 (XSS 완화, 탭 간 공유 안됨)
- Refresh Token은 이미 HttpOnly Cookie로 구현됨
- Epic 2 시작 전 보안 요구사항 문서화

### 2. 코드 리뷰에서 발견된 이슈들의 광범위성

**Bob (Scrum Master):** "패턴 분석 결과: 4개 스토리 중 4개 모두에서 코드 리뷰가 critical/high 버그를 발견했습니다."

**패턴:**
- 모든 story에서 코드 리뷰 필요 (선택사항 아님)
- 보안 이슈가 거의 모든 story에서 발생
- 초기 구현보다 리뷰 후 수정이 더 오래 걸림

**해결 방안:**
- 코드 리뷰를 정착화된 프로세스로 변경
- 보안 요구사항을 개발 전에 명확히 정의

### 3. 테스트 부채

**모든 Story:**
- Task 9/10 (테스트 작성) 선택사항으로 결정
- 단위 테스트, 통합 테스트 미작성
- E2E 테스트 프레임워크 설정 안 됨

**영향:**
- 현재는 수동 테스트로 검증
- 자동화된 회귀 테스트 없음
- Epic 2에서 테스트 부담 증가 가능

---

## 주요 Insights & Lessons Learned

### 1. 코드 리뷰는 필수, 선택사항 아님

**Charlie (Senior Dev):** "코드 리뷰 없었으면 critical bug들이 production에 갔을 거예요."

- 4개 story 모두에서 critical/high 버그 발견
- 리뷰가 개발자 혼자 발견하지 못한 이슈 찾아냄
- Story 1.4의 updateEmail bug가 대표적인 사례

**Action:** 모든 story는 merge 전 code-review 통과 (정착화)

### 2. 보안은 사후가 아니라 사전에

**Alice (Product Owner):** "보안 요구사항을 초기에 정의하면 시간 절약됩니다."

- localStorage → sessionStorage → HttpOnly Cookie 논의로 혼란
- XSS, CSRF, tokenVersion 같은 이슈가 모든 story에서 반복
- 개발 중간에 보안 기준 추가로 작업 증가

**Action:** Epic 2 시작 전 보안 요구사항 문서화

### 3. 테스트는 선택이 아닌 필수

**Bob (Scrum Master):** "선택사항으로 미루면 부채이 됩니다."

- 현재 수동 테스트로만 검증
- 자동화된 회귀 테스트 없음
- Epic 2에서 테스트 부담 증가 가능

**Action:** Epic 2에서 테스트 작성 고려 (Story당 2-3시간)

### 4. 팀 합의가 프로세스를 개선한다

**Alice (Product Owner):** "RBAC, 코드 리뷰 정착화 같은 팀 약속이 효과적입니다."

- 인증 관련 모든 mutation에 protectedProcedure 사용 (팀 합의)
- 보안 이슈는 CRITICAL로 분류하여 즉시 해결 (팀 합의)
- sessionStorage 사용 유지 (사용자 결정 + 팀 동의)

**Action:** 팀 합의 사항을 문서화하고 준수

---

## 다음 Epic 준비 (Epic 2: 파산 사건 관리)

### Epic 2 의존성 (Epic 1 완료 기반)

- ✅ 인증 시스템 (JWT, protectedProcedure)
- ✅ 사용자 모델 및 권한 관리 (Role enum: LAWYER, PARALEGAL, ADMIN, SUPPORT)
- ✅ tRPC 라우터 구조
- ✅ React Hook Form + Zod 패턴
- ✅ shadcn/ui 컴포넌트

### 준비 필요事项

**기술 설정 (Prerequisite):**

1. **Case Prisma Schema 생성**
   - 필드: caseNumber (unique), debtorName, courtName, filingDate, status, isArchived
   - 관계: lawyer (User), notes (CaseNote[])
   - Owner: Charlie
   - Estimated: 1시간

2. **CaseNote Prisma Schema 생성**
   - 필드: content, author (User), case (Case), createdAt
   - Owner: Charlie
   - Estimated: 30분

3. **RBAC helper 함수 구현**
   - canAccessCase(lawyerId, caseId) 함수
   - canModifyCase(lawyerId, caseId) 함수
   - Owner: Charlie
   - Estimated: 2시간

4. **권한 검증 미들웨어**
   - protectedProcedure에 RBAC 로직 추가
   - Owner: Elena (Charlie 멘토링)
   - Estimated: 1시간

**지식 개발:**

5. **RBAC 패턴 팀 워크샵**
   - Story 2.2, 2.3, 2.4에서 권한 검증 패턴 학습
   - Owner: Charlie
   - Estimated: 1시간

**총 예상 effort:** 5.5시간

### Critical Path (Epic 2 시작 전 필수)

1. ✅ Case & CaseNote Prisma Schema
   - Owner: Charlie
   - Deadline: Epic 2 Kickoff 전

2. ✅ RBAC 기본 구현
   - Owner: Charlie
   - Deadline: Story 2.2 시작 전 (권한 검증 핵심)

### 예상되는 도전

**Charlie (Senior Dev):** "제 걱정은 Prisma Schema입니다. Case 모델을 아직 안 만들었어요. 지금 만들지 않으면 Epic 2 시작할 때 병목이 될 거예요."

**Dana (QA Engineer):** "RBAC가 필요해요. Story 2.2, 2.3, 2.4에서 '다른 변호사의 사건 접근 불가'라고 명확히 되어 있거든요."

**Elena (Junior Dev):** "저는 인프라보다 지식이 더 걱정돼요. 제가 Epic 2 스토리에서 RBAC 패턴을 잘 이해하지 못하면 일하기 어려울 것 같아요."

---

## Action Items (Epic 1)

### 프로세스 개선

1. **코드 리뷰 정착화**
   - Owner: Charlie (Senior Dev)
   - Deadline: Epic 2 시작 전
   - Success criteria: 모든 story는 merge 전 code-review 통과

2. **보안 요구사항 초기 정의**
   - Owner: Alice (Product Owner) + Charlie (Senior Dev)
   - Deadline: Epic 2 kickoff 시점
   - Success criteria: Epic 2 개발 전 보안 요구사항 문서화 완료

### 기술적 부채

3. **통합 테스트 작성**
   - Owner: Dana (QA Engineer)
   - Priority: MEDIUM
   - Estimated effort: Story당 2-3시간
   - Note: 선택사항이었으나 Epic 2에서 고려

4. **E2E 테스트 프레임워크 설정**
   - Owner: Elena (Junior Dev)
   - Priority: MEDIUM
   - Estimated effort: Playwright 초기 설정 4시간
   - Note: Epic 2 시작 전 권장

### 팀 합의

- 인증 관련 모든 mutation은 protectedProcedure 사용 ✅
- 보안 이슈는 CRITICAL로 분류하여 즉시 해결 ✅
- 코드 리뷰는 선택사항이 아닌 필수 프로세스 (새로운 합의)
- sessionStorage 사용 유지 (사용자 결정 유지)

---

## 중요한 발견 및 Epic 업데이트 필요 여부

### 발견 분석 결과

- ✅ Architecture 변경 없음
- ✅ 주요 범위 변경 없음
- ✅ 기술적 접근 방식 유효함
- ⚠️ 보안 요구사항이 예상보다 복잡함 (sessionStorage vs HttpOnly Cookie 논의)

### Epic 2 업데이트 필요 여부

**결론:** ❌ Epic 업데이트 불필요

**이유:**
- Epic 1의 발견이 Epic 2 계획을 근본적으로 변경하지 않음
- 인증 시스템 (Epic 1)이 사건 관리 (Epic 2)의 기반으로 완전히 유효함
- RBAC 요구사항이 이미 Epic 2 스토리에 명확히 정의됨
- 추가 의존성이나 통합 문제 없음

**Charlie (Senior Dev):** "모든 것이 계획대로 진행되었습니다. 방향이 맞아요."

---

## 준비 상태 평가

### 테스팅 & 품질
- **상태:** 단위 테스트 미작성 (선택사항으로 결정)
- ⚠️ **Action 필요:** Epic 2에서 테스트 작성 고려
- **Note:** 현재 수동 테스트로 검증 중

### 배포
- **상태:** 개발 환경 완료
- ✅ **Note:** Production 배포 예정 없음 (개발 단계)

### 이해관계자 수용
- **상태:** 요구사항 모두 충족
- ✅ **Acceptance criteria:** 모든 AC 달성

### 기술적 건강상태
- **상태:** 안정적
- ✅ **보안 기능:** JWT, tokenVersion, rate limiting 모두 구현
- ✅ **코드 품질:** 코드 리뷰 및 팔로우업 완료

### 해결되지 않은 Blocker
- **상태:** 없음
- ✅ **모든 critical/high 이슈 해결됨**

---

## 최종 평가

**Bob (Scrum Master):** "이 평가를 기반으로, Epic 1은 완전히 완료되었으며 Epic 2 시작 가능합니다."

**Alice (Product Owner):** "이런 철저함이 retrospective의 가치입니다."

**Charlie (Senior Dev):** "다음 epic 중간에 잡는 것보다 지금 잡는 게 나아요."

**Epic 1 상태:** ✅ **DONE - Ready for Epic 2**

---

## 다음 단계

1. **준비 작업 실행** (예상: 5.5시간)
   - Case & CaseNote Prisma Schema
   - RBAC helper 함수 및 미들웨어
   - 팀 워크샵

2. **Critical Path 항목 완료** (Epic 2 시작 전)
   - Prisma Schema 생성
   - RBAC 기본 구현

3. **다음 standup에서 action items 리뷰**
   - 코드 리뷰 정착화
   - 보안 요구사항 문서화

4. **준비 완료 시 Epic 2 시작**
   - `create-story` workflow로 story 생성
   - Epic은 자동으로 `in-progress`로 변경됨

---

## 팀 성과

**Epic 1은 4개 스토리를 완료했고:**
- JWT 인증 시스템 (Access Token + Refresh Token)
- tokenVersion rotation
- Rate limiting
- 이메일 인증 (verification token)
- 비밀번호 재설정
- 프로필 관리

**보안 성과:**
- XSS 완화 (sessionStorage)
- CSRF 방지 (HttpOnly Cookie for Refresh Token)
- Brute force 방지 (Rate limiting)
- Session 무효화 (tokenVersion increment)

**코드 품질:**
- 10+ 개 리뷰 이슈 발견 및 해결
- Critical bug 수정 (updateEmail)
- AuthContext 최적화

**Bob (Scrum Master):** "좋은 작업이었습니다, 팀 여러분. Epic 1에서 많이 배웠습니다. 이 insights를 사용해서 Epic 2를 더 낫게 만들어요."

**Alice (Product Owner):** "Epic 2 planning에서 뵙겠습니다!"

**Charlie (Senior Dev):** "준비 작업부터 시작하죠!"

---

*Retrospective 작성: 2026-01-08*
*작성자: Bob (Scrum Master) / Claude Sonnet 4.5*
*프로젝트: paros BMAD*
